{
  "table": "report_orders",
  "instructions": [
    "‚öôÔ∏è INSTRU√á√ïES GERAIS:",
    "- Use exatamente os nomes das colunas conforme listados no schema acima.",
    "- Nunca traga nenhum dado sens√≠vel ou informa√ß√£o pessoal de clientes.",
    "- Utilize a tabela `receivables_db.report_orders` como padr√£o de consulta.",
    "- As colunas de data e hora ('date order created', 'contract start date', 'early purchase date', 'cancelled at', 'finished at') j√° est√£o salvas no timezone de Miami (America/New_York). N√£o √© necess√°rio converter o timezone ao consultar essas colunas.",
    "- Para perguntas que envolvam compara√ß√£o entre per√≠odos (ex: comparar per√≠odos, compara√ß√£o entre per√≠odos, m√™s vs m√™s, ano vs ano, etc.), gere a query usando CROSS JOIN para garantir compatibilidade com o Athena. Nunca utilize subqueries no FROM ou JOINs tradicionais para esse tipo de compara√ß√£o."
  ],
  "query_athena": [
    "- Colunas com espa√ßos devem ser envolvidas entre aspas duplas, como em: \"Contract Start Date\".",
    "- Sempre defina um alias ap√≥s fun√ß√µes agregadas como COUNT, SUM, AVG (ex: COUNT(*) AS total).",
    "- As colunas de data s√£o armazenadas como texto no formato '%Y-%m-%d %I:%i %p' (12h com AM/PM).",
    "- Sempre aplique `TRIM()` em colunas de data antes de usar `DATE_PARSE`.",
    "- Sempre use `TRY(CAST(... AS TIMESTAMP))` ao aplicar `DATE_PARSE` para evitar erros de parsing.",
    "- Para filtros de data, **nunca compare diretamente com `CURRENT_DATE`**.",
    "- Para filtros di√°rios, use `BETWEEN` com timezone 'America/New_York', como neste exemplo:",
    "  TRY(CAST(date_parse(TRIM(\"Contract Start Date\"), '%Y-%m-%d %I:%i %p') AS TIMESTAMP))",
    "  BETWEEN",
    "  date_trunc('day', current_timestamp AT TIME ZONE 'America/New_York')",
    "  AND",
    "  date_trunc('day', current_timestamp AT TIME ZONE 'America/New_York') + interval '1' day",
    "- Para c√°lculos matem√°ticos: use CAST(valor AS DOUBLE) para convers√µes num√©ricas.",
    "- Para percentuais: valor * (1 + percentual/100) - extraia o n√∫mero da pergunta.",
    "- Para divis√µes: CAST(numerador AS DOUBLE) / CAST(denominador AS DOUBLE).",
    "- Para obter dias do m√™s: EXTRACT(day FROM date_trunc('month', timestamp) + interval '1' month - interval '1' day).",
    "- Para filtros semanais, use date_trunc('week', ...) para o in√≠cio da semana e date_add('day', 6, date_trunc('week', ...)) para o fim da semana. Exemplo: BETWEEN date_trunc('week', <coluna_data>) AND date_add('day', 6, date_trunc('week', <coluna_data>)).",
    "- Para filtros de um m√™s completo (do dia 1 ao √∫ltimo dia), use:",
    "  BETWEEN date_trunc('month', current_timestamp AT TIME ZONE 'America/New_York')",
    "  AND date_trunc('month', current_timestamp AT TIME ZONE 'America/New_York') + interval '1' month - interval '1' day",
    "- Para filtros ENTRE per√≠odos mensais (ex: m√™s passado), use apenas:",
    "  BETWEEN date_trunc('month', date_add('month', -1, current_timestamp AT TIME ZONE 'America/New_York'))",
    "  AND date_trunc('month', current_timestamp AT TIME ZONE 'America/New_York')",
    "- NUNCA adicione '- interval 1 day' em filtros BETWEEN per√≠odos mensais",
    "- Para filtros de ano passado, use SEMPRE o seguinte intervalo: BETWEEN date_trunc('year', date_add('year', -1, current_timestamp AT TIME ZONE 'America/New_York')) E date_trunc('year', current_timestamp AT TIME ZONE 'America/New_York') - interval '1' day. Exemplo: WHERE ... BETWEEN date_trunc('year', date_add('year', -1, current_timestamp AT TIME ZONE 'America/New_York')) AND date_trunc('year', current_timestamp AT TIME ZONE 'America/New_York') - interval '1' day",
    "- Nunca use a fun√ß√£o `last_day`, pois ela n√£o existe no Athena."
  ],
  "regras_semanticas": [
    "üß† REGRAS DE INTERPRETA√á√ÉO:",
    "- Se a pergunta mencionar **vendas** (como 'quantas vendas hoje', 'vendas no m√™s'), use a coluna \"contract start date\" como data de refer√™ncia.",
    "- TODOS OS STATUS POSS√çVEIS (use exatamente estes valores):",
    "  ‚Ä¢ APPROVED - Pedidos aprovados",
    "  ‚Ä¢ CANCELED - Pedidos cancelados",
    "  ‚Ä¢ CLOSED - Pedidos fechados (maior volume)",
    "  ‚Ä¢ CLOSED BY FRAUD - Pedidos fechados por fraude",
    "  ‚Ä¢ DELIVERED - Pedidos entregues",
    "  ‚Ä¢ DENIED - Pedidos negados",
    "  ‚Ä¢ EARLY PURCHASE - Quita√ß√µes antecipadas",
    "  ‚Ä¢ FINISHED - Pedidos finalizados",
    "  ‚Ä¢ FRAUD - Pedidos com fraude",
    "  ‚Ä¢ IN TRANSIT - Pedidos em tr√¢nsito",
    "  ‚Ä¢ OPEN - Pedidos abertos",
    "  ‚Ä¢ PARTIAL PAYMENT - Pagamentos parciais",
    "  ‚Ä¢ PDD - Documentos pendentes",
    "  ‚Ä¢ PENDING PAYMENT - Pagamentos pendentes",
    "  ‚Ä¢ RECOVERY PDD - Recupera√ß√£o de PDD",
    "  ‚Ä¢ WAITING ANALISYS - Aguardando an√°lise",
    "  ‚Ä¢ WAITING SHIPMENT - Aguardando envio",
    "  ‚Ä¢ WAITING SIGN - Aguardando assinatura",
    "- Se a pergunta mencionar **pedidos finalizados**, utilize WHERE status = 'FINISHED' e opcionalmente \"finished at\" para filtros de data.",
    "- Se a pergunta envolver **cancelamentos**, utilize WHERE status = 'CANCELED' e opcionalmente \"cancelled at\" para filtros de data.",
    "- Se a pergunta mencionar **aguardando assinatura**, utilize WHERE status = 'WAITING SIGN'.",
    "- Se a pergunta mencionar **entregues** ou **entregados**, utilize WHERE status = 'DELIVERED'.",
    "- Se a pergunta mencionar **fechados** ou **closed**, utilize WHERE status = 'CLOSED'.",
    "- Se a pergunta mencionar **negados** ou **denied**, utilize WHERE status = 'DENIED'.",
    "- Se a pergunta mencionar **em tr√¢nsito** ou **transit**, utilize WHERE status = 'IN TRANSIT'.",
    "- Para perguntas com c√°lculos percentuais e divis√µes por tempo, use WITH para organizar subqueries e aplique opera√ß√µes matem√°ticas padr√£o do SQL.",
    "- Se a pergunta mencionar **aguardando an√°lise**, utilize WHERE status = 'WAITING ANALISYS'.",
    "- Se a pergunta mencionar **aguardando envio**, utilize WHERE status = 'WAITING SHIPMENT'.",
    "- Se a pergunta mencionar **PDD** ou **documentos pendentes**, utilize WHERE status = 'PDD'.",
    "- Se a pergunta mencionar **fraude**, utilize WHERE status = 'FRAUD'.",
    "- Se a pergunta mencionar **fechados por fraude**, utilize WHERE status = 'CLOSED BY FRAUD'.",
    "- Se a pergunta mencionar **aprovados**, utilize WHERE status = 'APPROVED'.",
    "- Se a pergunta mencionar **abertos**, utilize WHERE status = 'OPEN'.",
    "- Se a pergunta mencionar **pagamento pendente**, utilize WHERE status = 'PENDING PAYMENT'.",
    "- Se a pergunta mencionar **pagamento parcial**, utilize WHERE status = 'PARTIAL PAYMENT'.",
    "- Se a pergunta mencionar **recupera√ß√£o PDD**, utilize WHERE status = 'RECOVERY PDD'.",
    "- Para **quita√ß√µes** ou **pagamentos antecipados**, utilize WHERE status = 'EARLY PURCHASE' ou WHERE \"early purchase value\" > 0.",
    "- Para **inadimplentes**, utilize WHERE \"status default\" IN ('N1', 'N2', 'N3', 'N4', 'N5', 'N6', 'N7') (c√≥digos de inadimpl√™ncia).",
    "- Para **clientes regulares**, utilize WHERE \"status default\" = 'REGULAR'.",
    "- Para **clientes OK**, utilize WHERE \"status default\" = 'OK'.",
    "- Para contar **pedidos em geral**, use COUNT(DISTINCT \"order code\").",
    "- Para valores monet√°rios, sempre use SUM() com alias apropriado.",
    "- Sempre que for realizar contagens (COUNT) ou somas (SUM), trate valores nulos como zero usando COALESCE(coluna, 0) no SQL ou fillna(0) no pandas.",
    "- Para contagens simples de status, use COUNT(*) WHERE status = 'STATUS_DESEJADO'.",
    "- Quando a pergunta mencionar **vendas ativas** (como 'vendas em andamento', 'vendas ativas', 'pedidos ativos'), utilize WHERE status IN ('IN TRANSIT', 'WAITING SHIPMENT', 'DELIVERED').",
    "- Para perguntas sobre **total recebido** (como 'quanto j√° foi recebido', 'total recebido', 'valor recebido'), utilize a coluna \"order total paid\" e a fun√ß√£o SUM().",
    "- Para perguntas sobre **m√©dia de pagamento antecipado**, utilize a coluna \"early purchase value\" e a fun√ß√£o AVG().",
    "- Para perguntas sobre **maior pagamento antecipado**, utilize a coluna \"early purchase value\" e a fun√ß√£o MAX().",
    "- Para perguntas sobre **menor pagamento antecipado**, utilize a coluna \"early purchase value\" e a fun√ß√£o MIN().",
    "- Para perguntas sobre **valores vendidos** ou **total vendido**, considere apenas os status 'DELIVERED', 'EARLY PURCHASE', 'FINISHED', 'IN TRANSIT', 'PDD', 'WAITING SHIPMENT' e some os valores da coluna \"contract total value expected\".",
    "- Para perguntas sobre ** valor / valores total(is) de Fraudes e PDDs**, filtre WHERE status IN ('FRAUD', 'PDD') e some a coluna 'remaining total' tratando nulos com COALESCE('remaining total', 0) no SQL ou fillna(0) no pandas.",
    "- Para perguntas sobre valor ou valores a receber devidos a PDDs e fraudes (como 'valor devido a PDD', 'total devido a fraudes', 'valores pendentes de PDD e fraude'), considere apenas os status ['PDD', 'FRAUD'] e some a coluna 'order total paid', tratando nulos com COALESCE('order total paid', 0) no SQL ou fillna(0) no pandas.",
    "- Para perguntas sobre valor ou valores a receber devido a fraude (como 'valor a receber de fraude', 'total a receber de fraudes', 'valores pendentes de fraude'), considere apenas o status 'FRAUD' e some a coluna 'order total paid', tratando nulos com COALESCE('order total paid', 0) no SQL ou fillna(0) no pandas.",
    "- Para perguntas sobre total de vendas, pedidos ou ordens geradas (como 'total de vendas geradas', 'quantos pedidos foram gerados', 'quantas ordens geradas'), considere apenas os registros cujo status N√ÉO esteja em ['DENIED', 'OPEN', 'CLOSED', 'CLOSED BY FRAUD', 'WAITING ANALISYS', 'DELIVERY_CANCELLED', 'RECUSED', 'PENDING PAYMENT', 'PARTIAL PAYMENT', 'APPROVED'] e fa√ßa a contagem, tratando nulos com COALESCE ou fillna(0) se necess√°rio.",
    "- Para perguntas sobre valores a receber, considere apenas os registros cujo status esteja em ['DELIVERED', 'IN TRANSIT', 'WAITING SHIPMENT'] e some a coluna 'remaining total', tratando nulos com COALESCE('remaining total', 0) no SQL ou fillna(0) no pandas.",
    "- Para perguntas sobre valores deixados de arrecadar devido a quita√ß√µes antecipadas, calcule usando:  'Contract Total Value Expected' - 'Order Total Paid'"
  ],
  "exemplos_queries": [
    "üìù EXEMPLOS DE QUERIES IMPORTANTES:",
    "- Para cancelamentos: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'CANCELED'",
    "- Para finalizados: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'FINISHED'",
    "- Para entregues: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'DELIVERED'",
    "- Para fechados: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'CLOSED'",
    "- Para negados: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'DENIED'",
    "- Para aguardando assinatura: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'WAITING SIGN'",
    "- Para em tr√¢nsito: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'IN TRANSIT'",
    "- Para aguardando an√°lise: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'WAITING ANALISYS'",
    "- Para aguardando envio: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'WAITING SHIPMENT'",
    "- Para PDD: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'PDD'",
    "- Para quita√ß√µes antecipadas: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'EARLY PURCHASE'",
    "- Para aprovados: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'APPROVED'",
    "- Para abertos: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'OPEN'",
    "- Para fraude: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'FRAUD'",
    "- Para fechados por fraude: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'CLOSED BY FRAUD'",
    "- Para pagamento pendente: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'PENDING PAYMENT'",
    "- Para pagamento parcial: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'PARTIAL PAYMENT'",
    "- Para recupera√ß√£o PDD: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE status = 'RECOVERY PDD'",
    "- Para inadimplentes: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE \"status default\" IN ('N1', 'N2', 'N3', 'N4', 'N5', 'N6', 'N7')",
    "- Para clientes regulares: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE \"status default\" = 'REGULAR'",
    "- Para clientes OK: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE \"status default\" = 'OK'",
    "- Para vendas hoje: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE TRY(CAST(date_parse(TRIM(\"contract start date\"), '%Y-%m-%d %I:%i %p') AS TIMESTAMP)) BETWEEN date_trunc('day', current_timestamp AT TIME ZONE 'America/New_York') AND date_trunc('day', current_timestamp AT TIME ZONE 'America/New_York') + interval '1' day",
    "- Para clientes √∫nicos: SELECT COUNT(DISTINCT \"customer name\") AS total FROM receivables_db.report_orders",
    "- Para todos os status: SELECT status, COUNT(*) AS total FROM receivables_db.report_orders GROUP BY status ORDER BY total DESC",
    "- Para total recebido: SELECT SUM(\"order total paid\") AS total_recebido FROM receivables_db.report_orders",
    "- Para m√©dia de pagamento antecipado: SELECT AVG(\"early purchase value\") AS media_pagamento_antecipado FROM receivables_db.report_orders",
    "- Para maior pagamento antecipado: SELECT MAX(\"early purchase value\") AS maior_pagamento_antecipado FROM receivables_db.report_orders",
    "- Para menor pagamento antecipado: SELECT MIN(\"early purchase value\") AS menor_pagamento_antecipado FROM receivables_db.report_orders",
    "- Para vendas semanais: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE TRY(CAST(date_parse(TRIM(\"contract start date\"), '%Y-%m-%d %I:%i %p') AS TIMESTAMP)) BETWEEN date_trunc('week', current_timestamp AT TIME ZONE 'America/New_York') AND date_add('day', 6, date_trunc('week', current_timestamp AT TIME ZONE 'America/New_York'))",
    "- Para vendas na semana atual: SELECT COUNT(*) AS total FROM receivables_db.report_orders WHERE TRY(CAST(date_parse(TRIM(\"contract start date\"), '%Y-%m-%d %I:%i %p') AS TIMESTAMP)) BETWEEN date_trunc('week', current_timestamp AT TIME ZONE 'America/New_York') AND date_add('day', 6, date_trunc('week', current_timestamp AT TIME ZONE 'America/New_York'))"
  ]
}